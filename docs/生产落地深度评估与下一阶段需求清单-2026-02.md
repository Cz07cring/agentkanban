# 生产落地深度评估与下一阶段需求清单（2026-02）

## 1. 评估结论（站在项目开发专家 + 最终用户视角）

当前系统已经具备“可跑通”的业务主链路：项目创建、任务流转、调度执行、评审闭环、失败重试、看板可视化。

但如果目标是“真实生产环境长期稳定运行”，仍存在**7类关键缺口**：

1. **访问控制与多角色权限缺失（最高优先级）**
2. **项目治理状态虽然可控，但缺少强制流程门禁（DoR/DoD）**
3. **调度策略偏工程可用，未实现 SLA/公平性/优先级继承等生产策略**
4. **可观测性不完整（缺统一指标、告警阈值、审计检索）**
5. **发布与变更治理缺口（环境隔离、配置版本化、回滚剧本）**
6. **前端移动端可用性有进展，但端到端操作闭环仍有断点**
7. **数据模型仍以 JSON 文件为核心，扩展性/一致性风险较高**

> 建议定义当前阶段为：**“生产试点可用（Pilot）”**，而非“全面生产成熟（GA）”。

---

## 2. 现状证据（代码层）

### 2.1 已具备的能力（可作为继续迭代基础）

- 后端具备任务创建、调度、健康检查、引擎状态管理、人工触发调度等核心接口。  
- 项目模型已支持生命周期状态与时间戳（`status/updated_at/completed_at/archived_at`）。  
- 项目状态迁移已具备任务活跃度约束（例如有活跃任务禁止 completed/archived）。  
- 前端 API 层已覆盖任务/项目/调度等主要操作。  

### 2.2 主要薄弱点（生产化角度）

- 后端接口尚未看到认证鉴权中间件与 RBAC 校验，接口目前主要是“可调用即生效”。
- 当前存储仍以本地 JSON + 文件锁为主，缺乏数据库级事务、查询能力与审计索引。
- 文档与配置强调本地/单环境使用，缺少 staging/prod 的差异化门禁规范。

---

## 3. 关键缺口拆解（按用户旅程）

## 3.1 发起项目（Project Initiation）

### 已有
- 项目创建时能校验 Git 仓库路径并避免重名/重复绑定。
- 项目状态具备 `draft/active/on_hold/completed/archived` 的基础状态机。

### 缺口
1. **缺少项目模板（Template）与初始化检查清单**：
   - 用户创建后不知道“下一步必须配置什么”。
2. **缺少角色化入口**：
   - 谁可以创建项目、谁可以改状态没有硬约束。
3. **缺少业务元数据**：
   - 目前字段偏技术，缺少负责人、业务线、SLA、上线窗口等。

### 需求建议
- 新增项目模板：`web-feature / maintenance / emergency-fix`。
- 新增 `owner/tech_owner/sla_tier/release_window/risk_level` 字段。
- 新增“项目激活前检查”API：仓库、CI、通知渠道、值班人完整性校验。

## 3.2 需求分析与计划审批（Plan）

### 已有
- Plan 任务可进入 `plan_review`，并有审批与拆解流程。

### 缺口
1. **审批标准不结构化**（目前以文本反馈为主）。
2. **缺少 DoR（Definition of Ready）**：任务可进入执行，但业务约束不够硬。
3. **缺少风控标签**：高风险任务未触发更严格审批。

### 需求建议
- 增加 `plan_schema`（目标、范围、验收标准、回滚方案、风险点）。
- 引入审批规则引擎：`risk_level=high` 必须双人审批。
- 引入 DoR 校验器：未满足 DoR 自动拒绝 dispatch。

## 3.3 分发执行（Dispatch & Execution）

### 已有
- 有 dispatcher 循环、worker 健康状态、失败重试、引擎健康降级。

### 缺口
1. **缺少公平性与租户隔离策略**：多项目并发下可能“饿死”。
2. **缺少 SLA 感知调度**：高优任务未必得到稳定保障。
3. **重试策略未分层**：业务错误/系统错误/限流错误策略区分还不够。

### 需求建议
- 调度引入：`project_weight + aging + sla_boost`。
- 引入队列策略：`urgent lane / normal lane`。
- 失败分类枚举：`infra_error/rate_limit/logic_error`，策略分治。

## 3.4 Review 与交付

### 已有
- 对抗式 review 与 review->fix->verify 的基础循环存在。

### 缺口
1. **缺少发布前质量门禁统一视图**（测试覆盖、静态检查、风险等级）。
2. **缺少“可追溯交付包”**（变更单、影响面、回滚步骤）。
3. **缺少业务验收状态**（技术完成 ≠ 业务验收完成）。

### 需求建议
- 增加 `release_readiness` 汇总接口。
- 交付阶段新增状态：`ready_for_uat / uat_passed / released`。
- 自动生成交付摘要：commit、变更范围、风险、回滚步骤。

---

## 4. 非功能性缺口（生产必须补齐）

1. **安全**：认证、授权、审计、密钥管理。
2. **可观测**：Prometheus 指标、错误预算、告警路由。
3. **可靠性**：幂等键、补偿任务、死信队列。
4. **数据层**：从 JSON 逐步迁移到 PostgreSQL（至少双写过渡）。
5. **运维治理**：配置中心、灰度发布、版本兼容策略。

---

## 5. 建议的下一阶段落地路线（务实版）

## P0（1~2周，必须）
- 接口鉴权（最小可用 JWT + 项目级角色权限）。
- Dispatch 前增加 DoR 硬门禁。
- 删除/归档/完结动作统一审计日志。
- 基础告警：任务积压、失败率、worker 心跳异常。

## P1（2~4周，强烈建议）
- 引入 SLA 感知调度与公平性权重。
- 增加 release readiness 汇总与 UAT 状态。
- 项目模板 + 初始化检查清单。
- 关键业务指标看板（交付周期、返工率、失败重试占比）。

## P2（4~8周，中期）
- 数据层迁移（JSON -> PostgreSQL，保留导入导出）。
- 调度策略可配置化（按项目策略注入）。
- 变更影响分析与自动回滚剧本模板化。

---

## 6. 我给你的最终建议（决策层）

如果你希望“尽快进入真实生产”，不要再扩功能面，先压实以下三件事：

1. **权限体系**（谁能做什么）
2. **流程门禁**（什么时候允许进入下一阶段）
3. **可观测+告警**（出问题能在分钟级发现）

这三件完成后，再上调度高级策略和数据层升级，投入产出比最高。
